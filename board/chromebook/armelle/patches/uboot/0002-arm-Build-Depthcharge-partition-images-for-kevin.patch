From 33a73aac66341769199d4bcf04096db161397a55 Mon Sep 17 00:00:00 2001
From: Alper Nebi Yasak <alpernebiyasak@gmail.com>
Date: Sat, 8 Aug 2020 23:19:38 +0300
Subject: [PATCH 2/3] arm: Build Depthcharge partition images for kevin
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

On ARM chromebooks the Chromium OS bootloader ("Depthcharge") imposes some
constraints on U-Boot when chainloading it.

Set the necessary config options for chromebook kevin.

Signed-off-by: Alper Nebi Yasak <alpernebiyasak@gmail.com>
[Vincent: add only for chromebook kevin.]
Signed-off-by: Vincent Stehl√© <vincent.stehle@laposte.net>
---
 arch/arm/mach-rockchip/rk3399/Kconfig | 1 +
 configs/chromebook_kevin_defconfig    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/arch/arm/mach-rockchip/rk3399/Kconfig b/arch/arm/mach-rockchip/rk3399/Kconfig
index d01063ac98b..364b1fab412 100644
--- a/arch/arm/mach-rockchip/rk3399/Kconfig
+++ b/arch/arm/mach-rockchip/rk3399/Kconfig
@@ -18,6 +18,7 @@ config TARGET_CHROMEBOOK_KEVIN
 	bool "Samsung Chromebook Plus (RK3399)"
 	select HAS_ROM
 	select ROCKCHIP_SPI_IMAGE
+	select HAS_DEPTHCHARGE
 	help
 	  Kevin is a RK3399-based convertible chromebook. It has two USB 3.0
 	  Type-C ports, 4GB of SDRAM, WiFi and a 12.3" 2400x1600 display. It
diff --git a/configs/chromebook_kevin_defconfig b/configs/chromebook_kevin_defconfig
index 3d2642f0d07..dc5b6081e50 100644
--- a/configs/chromebook_kevin_defconfig
+++ b/configs/chromebook_kevin_defconfig
@@ -24,6 +24,7 @@ CONFIG_SPL_SPI_FLASH_SUPPORT=y
 CONFIG_SPL_SPI=y
 CONFIG_SYS_LOAD_ADDR=0x800800
 CONFIG_DEBUG_UART=y
+CONFIG_DEPTHCHARGE_PARTITION_IMAGE=y
 CONFIG_DEFAULT_FDT_FILE="rockchip/rk3399-gru-kevin.dtb"
 # CONFIG_DISPLAY_CPUINFO is not set
 CONFIG_DISPLAY_BOARDINFO_LATE=y
-- 
2.35.1

